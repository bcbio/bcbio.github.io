<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Location and duplication information from Ensembl &#8211; Blue Collar Bioinformatics</title>

<meta name="keywords" content="how-to">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Location and duplication information from Ensembl">

<meta name="twitter:site" content="@chapmanb">
<meta name="twitter:creator" content="@chapmanb">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Location and duplication information from Ensembl">

<meta property="og:url" content="http://localhost:4000/2009/01/31/location-and-duplication-information-from-ensembl/">
<meta property="og:site_name" content="Blue Collar Bioinformatics">





<link rel="canonical" href="http://localhost:4000/2009/01/31/location-and-duplication-information-from-ensembl/">
<link href="http://feeds2.feedburner.com/bcbio" type="application/atom+xml" rel="alternate" title="Blue Collar Bioinformatics Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="http://localhost:4000/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/articles/" >Recent</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/tags/" >Topics</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">Blue Collar Bioinformatics</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Biological data analysis, validation and visualization</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#how-to" title="Pages tagged how-to">how-to</a></span>
        
          <h1 class="entry-title">Location and duplication information from Ensembl</h1>
        
      </header>
      <footer class="entry-meta">
        
          
        
          <img src="http://localhost:4000/images/diego-work.jpg" class="bio-photo" alt="Brad Chapman bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Brad Chapman</span></span>
        <span class="entry-date date published"><time datetime="2009-01-31T15:11:22-05:00"><i class="fa fa-calendar-o"></i> January 31, 2009</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
      </footer>
      <div class="entry-content">
        <p>
Understanding the evolutionary history of a gene family may provide some insight into the mechanisms of its activity. Here we will look at two characteristics for a list of eukaryotic genes of interest:</p>
<ul>
<li> Groups that are co-located on a chromosome.</li>
<li> Groups evolutionarily related through duplication (<a href="http://homepage.usask.ca/~ctl271/857/def_homolog.shtml">paralogs</a>).
</li>
</ul>
<p>
By expanding on work done in an <a href="http://bcb.io/2008/12/28/comparative-genomics-information-retrieval-from-ensembl/">earlier post</a>, we will identify co-located and duplicated genes using information from the <a href="http://www.ensembl.org/">Ensembl</a> genome browser.</p>
<p>
Using our previous method of screen scraping with <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a>, we extend our Ensembl REST-like class to include two new functions. Location is represented as a list of chromosome name, start and end, and parsed from the Gene Summary page:</p>
<p>[sourcecode language="python"]<br />
def location(self, organism, gene_id):<br />
    with self._get_open_handle("Gene", "Summary",<br />
            organism, gene_id) as in_handle:<br />
        soup = BeautifulSoup(in_handle)<br />
        loc_tab = soup.find("dd", id="tab_location")<br />
        link = loc_tab.find("a")<br />
        path, attrs = urllib2.splitattr(link["href"])<br />
        for attr in attrs:<br />
            if attr.find("r=") == 0:<br />
                key, val = attr.split("=")<br />
                chrom, location = val.split(":")<br />
                start, end = location.split("-")<br />
                return chrom, int(start), int(end)<br />
        raise ValueError("Did not find location: %s" % link)<br />
[/sourcecode]</p>
<p>
Similarly, we can retrieve the details on paralogs from the Ensembl Comparative pages for the genes. With these two functions, a list of the protein IDs of interest, and a dictionary containing species and Ensembl ID references, we collect all of the location and duplication information into python dictionaries. At the same time we maintain a backwards mapping of Ensembl IDs to our original ID:</p>
<p>[sourcecode language="python"]<br />
ensembl_retriever = EnsemblComparaRest(cache_dir)<br />
loc_info = dict()<br />
dup_info = dict()<br />
ensembl_to_uniprot = dict()<br />
for cur_id in all_ids:<br />
    cur_rec = db[cur_id]<br />
    cur_ensembl_org = cur_rec["org_scientific_name"].replace(" ", "_")<br />
    for ensembl_id in cur_rec.get("db_refs_ensembl", []):<br />
        paralogs = ensembl_retriever.paralogs(cur_ensembl_org, ensembl_id)<br />
        chromosome, start, end = ensembl_retriever.location(<br />
                cur_ensembl_org, ensembl_id)<br />
        dup_info[ensembl_id] = paralogs<br />
        loc_info[ensembl_id] = (cur_rec["org_scientific_name"],<br />
            chromosome, start, end)<br />
        ensembl_to_uniprot[ensembl_id] = cur_id<br />
[/sourcecode]</p>
<p>
Now we want to flatten the paralog dictionary into a list of groups associated by duplication. This is done by using python sets; any groups with shared genes are combined and the resulting unique list is returned:</p>
<p>[sourcecode language="python"]<br />
def examine_paralogs(dup_info, ensembl_to_uniprot):<br />
    cur_groups = []<br />
    all_base = dup_info.keys()<br />
    for base_id, dup_ids in dup_info.items():<br />
        overlap = set(dup_ids) & set(all_base)<br />
        if len(overlap) > 0:<br />
            new_group = set([ensembl_to_uniprot[x] for x in overlap |<br />
                set([base_id])])<br />
            is_unique = True<br />
            for exist_i, exist_group in enumerate(cur_groups):<br />
                if len(new_group & exist_group) > 0:<br />
                    update_group = new_group & exist_group<br />
                    cur_groups[exist_i] = update_group<br />
                    is_unique = False<br />
                    break<br />
            if is_unique:<br />
                cur_groups.append(new_group)<br />
    return [list(g) for g in cur_groups]<br />
[/sourcecode]</p>
<p>
We use two functions to similarly group together genes by location. The first function calculates the actual distance given the previously retrieved location information list of <code>(organism, chromosome, start, end)</code>. Two items in different organisms or on different chromosomes are placed maximally far apart since they can't be co-located.</p>
<p>[sourcecode language="python"]<br />
def location_distance(loc_one, loc_two):<br />
    if loc_one[:2] != loc_two[:2] or loc_one == loc_two:<br />
        return sys.maxint<br />
    else:<br />
        return max(abs(loc_one[3] - loc_two[2]),<br />
                   abs(loc_two[3] - loc_one[2]))<br />
[/sourcecode]</p>
<p>
The next function creates a dictionary of genes co-located based on our threshold, and then uses the <code>examine_paralogs</code> flattening function we defined above to generate groups from this dictionary. The variable <code>distance_thresh</code> defines the distance in which two genes are considered co-located. For the example script, 1 megabase is used, but this can be adjusted according to your own personal definition of close.</p>
<p>[sourcecode language="python"]<br />
def examine_location(loc_info, ensembl_to_uniprot, distance_thresh):<br />
    loc_close = collections.defaultdict(lambda: [])<br />
    for uniprot_id, loc_one in loc_info.items():<br />
        for cmp_id, loc_two in loc_info.items():<br />
            if location_distance(loc_one, loc_two) <= distance_thresh:<br />
                loc_close[uniprot_id].append(cmp_id)<br />
    return examine_paralogs(loc_close, ensembl_to_uniprot)<br />
[/sourcecode]</p>
<p>
The <a href="http://github.com/chapmanb/bcbb/blob/507cbb02c3531dddef67fd25087b3954f51e9d25/classify/loc_dup_cluster.py">full script</a> takes a file input with each line being a uniprot ID and gene name, and also requires a UniProt shelve database like we <a href="http://bcb.io/2009/01/10/extracting-protein-characteristics-for-an-interpro-domain/">developed earlier</a>. This shelve database provides the base ID to ensembl ID mappings and organism information, which can be parsed from UniProt XML files.</p>
<p>
The resulting co-location and duplication groups are sets of genes which may share an intriguing evolutionary history. The paralogs have been computationally determined to be evolutionarily related based on sequence similarity and the composition of their <a href="http://www.ensembl.org/info/docs/compara/homology_method.html">gene family tree</a>. The co-located genes may be co-selected during evolution, be the result of localized gene duplication obscured by extensive sequence change, or simply be close together based on chance. Further examination of your gene family in light of this information can help determine which of these hypotheses to favor.</p>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bcbio'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/2009/01/24/graphing-of-variables-before-classification/" class="btn" title="Graphing of variables before classification">Previous</a>
      
      
        <a href="http://localhost:4000/2009/02/07/automated-protein-conservation-display-from-blast-alignments/" class="btn" title="Automated protein conservation display from BLAST alignments">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<div class="social-icons">
	<a href="https://twitter.com/chapmanb" title="Brad Chapman on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://github.com/chapmanb" title="Brad Chapman on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="https://github.com/chapmanb" title="Brad Chapman on Bitbucket" target="_blank"><i class="fa fa-bitbucket-square fa-2x"></i></a>
	
	
	
	
	
	
  
	
	<a href="https://linkedin.com/pub/3/300/8ba" title="Brad Chapman on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
  <a href="http://feeds2.feedburner.com/bcbio" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
