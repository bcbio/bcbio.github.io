<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Gene Ontology analysis with Python and Bioconductor &#8211; Blue Collar Bioinformatics</title>

<meta name="keywords" content="how-to">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Gene Ontology analysis with Python and Bioconductor">

<meta name="twitter:site" content="@chapmanb">
<meta name="twitter:creator" content="@chapmanb">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Gene Ontology analysis with Python and Bioconductor">

<meta property="og:url" content="http://localhost:4000/2009/10/18/gene-ontology-analysis-with-python-and-bioconductor/">
<meta property="og:site_name" content="Blue Collar Bioinformatics">





<link rel="canonical" href="http://localhost:4000/2009/10/18/gene-ontology-analysis-with-python-and-bioconductor/">
<link href="http://feeds2.feedburner.com/bcbio" type="application/atom+xml" rel="alternate" title="Blue Collar Bioinformatics Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="http://localhost:4000/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/articles/" >Recent</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/tags/" >Topics</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">Blue Collar Bioinformatics</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Biological data analysis, validation and visualization</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#how-to" title="Pages tagged how-to">how-to</a></span>
        
          <h1 class="entry-title">Gene Ontology analysis with Python and Bioconductor</h1>
        
      </header>
      <footer class="entry-meta">
        
          
        
          <img src="http://localhost:4000/images/diego-work.jpg" class="bio-photo" alt="Brad Chapman bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Brad Chapman</span></span>
        <span class="entry-date date published"><time datetime="2009-10-18T11:03:24-04:00"><i class="fa fa-calendar-o"></i> October 18, 2009</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
      </footer>
      <div class="entry-content">
        <p>
Last post we discussed <a href="http://bcbio.wordpress.com/2009/09/13/differential-expression-analysis-with-bioconductor-and-python/">extracting differentially expressed genes</a> from a set of short read data. The output of this analysis is a large list of genes, and the next challenge is to try and extract interesting patterns from the results. Are genes in particular families over-represented? Are there a large number of genes with a particular function? These patterns can help direct your future experiments and provide an understandable grouping for biologists examining the data.</p>
<p>
The <a href="http://www.geneontology.org/">Gene Ontology (GO)</a> project provides a standardized set of terms describing the molecular function of genes. We will use the <a href="http://www.bioconductor.org/packages/bioc/html/topGO.html">topGO</a> package from the <a href="http://www.bioconductor.org/">Bioconductor</a> project to identify over-represented GO terms from a set of differentially expressed genes. Python will be used to prepare the data, utilizing <a href="http://rpy.sourceforge.net/rpy2.html">rpy2</a> to call <a href="http://www.r-project.org/">R</a> for the statistical analysis.</p>
<p>
The first step is to parse input files describing the differentially expressed genes and the mapping of gene names to GO terms. For the example we will use a <a href="http://github.com/chapmanb/bcbb/blob/master/stats/diffexp_example-diffs.csv">simple CSV file from our previous analysis</a> and an <a href="http://github.com/chapmanb/bcbb/blob/master/stats/diffexp_example-go_map.txt">equally simple file describing the gene to GO mapping</a>. For real life work, you will need to get the GO mapping file for your organism; for instance, here is the <a href="ftp://ftp.arabidopsis.org/home/tair/Ontologies/Gene_Ontology/ATH_GO_GOSLIM.txt">Arabidopsis GO mapping from TAIR</a>.</p>
<p>
The input file of differentially expressed genes is parsed into a dictionary where the keys are gene names and the values are associated p-values:</p>
<p>[sourcecode language="python"]<br />
import csv</p>
<p>def parse_input_csv(in_handle):<br />
    reader = csv.reader(in_handle)<br />
    reader.next() # header<br />
    all_genes = dict()<br />
    for (gene_name, _, _, pval) in reader:<br />
        all_genes[gene_name] = float(pval)<br />
    return all_genes<br />
[/sourcecode]</p>
<p>
The GO mapping input file is parsed into two dictionaries: one mapping genes to GO terms for the GO analysis, and the second mapping GO terms to genes for displaying the results of the analysis:</p>
<p>[sourcecode language="python"]<br />
import collections</p>
<p>def parse_go_map_file(in_handle, genes_w_pvals):<br />
    gene_list = genes_w_pvals.keys()<br />
    gene_to_go = collections.defaultdict(list)<br />
    go_to_gene = collections.defaultdict(list)<br />
    for line in in_handle:<br />
        parts = line.split("\t")<br />
        gene_id = parts[0]<br />
        go_id = parts[1].strip()<br />
        if gene_id in gene_list:<br />
            gene_to_go[gene_id].append(go_id)<br />
            go_to_gene[go_id].append(gene_id)<br />
    return dict(gene_to_go), dict(go_to_gene)<br />
[/sourcecode]</p>
<p>
Next we set up our associated R environment for GO analysis. This involves loading the topGO library and creating a function to classify genes as either differentially expressed, or not. We do this based on the p-value, classifying genes with a p-value of 0.01 or less as differentially expressed:</p>
<p>[sourcecode language="python"]<br />
import rpy2.robjects as robjects</p>
<p>gene_pval = 1e-2<br />
robjects.r('''<br />
    library(topGO)<br />
''')<br />
robjects.r('''<br />
    topDiffGenes = function(allScore) {<br />
      return (allScore &lt; %s)<br />
    }<br />
&#39;&#39;&#39; % gene_pval)<br />
[/sourcecode]</p>
<p>
Now it's time to run the analysis. The paramters are defined as a dictionary which initializes a <code>topGOdata</code> object:</p>
<ul>
<li>ontology -- the type of GO ontology to analyze; molecular function (MF) is examined here.
  </li>
<li>annot -- how the GO terms are annotated; we specify they will be identified by a mapping of genes to GO ids, passed as the gene2GO argument.
  </li>
<li>geneSelectionFun -- the function we defined above to determine if genes are differentially expressed.
  </li>
<li>allGenes -- an R named vector where the names are genes and the values are p-values; we use a utility function to convert a python dictionary to the named vector.
  </li>
<li>gene2GO -- an R named vector mapping gene names to associated GO terms.
</li>
</ul>
<p>The initialized object is run using Fisher classic analysis. Several different analysis methods and test statistics are available in the package. The resulting scores are extracted and a summary table of the results is generated:</p>
<p>[sourcecode language="python"]<br />
def _dict_to_namedvector(init_dict):<br />
    """Call R to create a named vector from an input dictionary.<br />
    """<br />
    return robjects.r.c(**init_dict)</p>
<p>go_term_type = "MF"<br />
topgo_method = "classic" # choice of classic, elim, weight<br />
params = {"ontology" : go_term_type,<br />
          "annot" : robjects.r["annFUN.gene2GO"],<br />
          "geneSelectionFun" : robjects.r["topDiffGenes"],<br />
          "allGenes" : _dict_to_namedvector(gene_vals),<br />
          "gene2GO" : _dict_to_namedvector(gene_to_go)<br />
          }<br />
go_data = robjects.r.new("topGOdata", **params)<br />
results = robjects.r.runTest(go_data, algorithm=topgo_method,<br />
        statistic="fisher")<br />
scores = robjects.r.score(results)<br />
score_names = scores.getnames()<br />
num_summarize = min(100, len(score_names))<br />
results_table = robjects.r.GenTable(go_data, elimFisher=results,<br />
        orderBy="elimFisher", topNodes=num_summarize)<br />
[/sourcecode]</p>
<p>
The scores and results table are used to generate a list of over-represented GO terms with their associated p-values and descriptions:</p>
<p>[sourcecode language="python"]<br />
# extract term names from the topGO summary dataframe<br />
GO_ID_INDEX = 0<br />
TERM_INDEX = 1<br />
ids_to_terms = dict()<br />
for index, go_id in enumerate(results_table[GO_ID_INDEX]):<br />
    ids_to_terms[go_id] = results_table[TERM_INDEX][index]<br />
go_terms = []<br />
# convert the scores and results information info terms to return<br />
for index, item in enumerate(scores):<br />
    if item &lt; go_pval:<br />
        go_id = score_names[index]<br />
        go_terms.append((item, go_id, ids_to_terms.get(go_id, &quot;&quot;)))<br />
go_terms.sort()<br />
[/sourcecode]</p>
<p>
Finally, we print out the resulting overexpressed GO terms along with associated genes:</p>
<p>[sourcecode language="python"]<br />
def print_go_info(go_terms, go_term_type, go_to_gene):<br />
    for final_pval, go_id, go_term in go_terms:<br />
        genes = []<br />
        for check_go in [go_id] + get_go_children(go_id, go_term_type):<br />
            genes.extend(go_to_gene.get(check_go, []))<br />
        genes = sorted(list(set(genes)))<br />
        print "-&gt; %s (%s) : %0.4f" % (go_id, go_term, final_pval)<br />
        for g in genes:<br />
            print g<br />
[/sourcecode]</p>
<p>
One tricky part of the post-analysis processing is finding all of the genes associated with an identified GO id. The GO terminology is hierarchical, so a resulting GO identifier like <code>GO:0042578</code> in the <a href="http://github.com/chapmanb/bcbb/blob/master/stats/diffexp_example-go_results.txt">example results file</a> can represent both that term and more specific terms. A nice way to illustrate this for yourself is to look at the <a href="http://amigo.geneontology.org/cgi-bin/amigo/term-details.cgi?term=GO:0042578&amp;session_id=2471amigo1255800166">AmiGO browser display for the term</a>.</p>
<p>
The result is that genes associated with an over-represented term will come from both the identified term and more specific terms. Bioconductor has an interface to the GO database, so we can extract all of the relevant terms by moving down the GO tree collecting the more specific children, given the parent term:</p>
<p>[sourcecode language="python"]<br />
def get_go_children(go_term, go_term_type):<br />
    robjects.r('''<br />
        library(GO.db)<br />
    ''')<br />
    child_map = robjects.r["GO%sCHILDREN" % (go_term_type)]<br />
    children = []<br />
    to_check = [go_term]<br />
    while len(to_check) &gt; 0:<br />
        new_children = []<br />
        for check_term in to_check:<br />
            new_children.extend(list(robjects.r.get(check_term, child_map)))<br />
        new_children = list(set([c for c in new_children if c]))<br />
        children.extend(new_children)<br />
        to_check = new_children<br />
    children = list(set(children))<br />
    return children<br />
[/sourcecode]</p>
<p>
The <a href="http://github.com/chapmanb/bcbb/blob/master/stats/diffexp_go_analysis.py">full script</a> pulls all of this code together into a working example. You will need to update the parsers to match your input and GO mapping file, but otherwise the code can plug directly into full genome analyses of differential expression data.</p>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bcbio'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/2009/09/13/differential-expression-analysis-with-bioconductor-and-python/" class="btn" title="Differential expression analysis with Bioconductor and Python">Previous</a>
      
      
        <a href="http://localhost:4000/2010/01/02/automated-retrieval-of-expression-data-with-python-and-r/" class="btn" title="Automated retrieval of expression data with Python and R">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<div class="social-icons">
	<a href="https://twitter.com/chapmanb" title="Brad Chapman on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://github.com/chapmanb" title="Brad Chapman on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="https://github.com/chapmanb" title="Brad Chapman on Bitbucket" target="_blank"><i class="fa fa-bitbucket-square fa-2x"></i></a>
	
	
	
	
	
	
  
	
	<a href="https://linkedin.com/pub/3/300/8ba" title="Brad Chapman on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
  <a href="http://feeds2.feedburner.com/bcbio" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
