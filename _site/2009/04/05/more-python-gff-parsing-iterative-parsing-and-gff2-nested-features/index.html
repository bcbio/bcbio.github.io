<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>More python GFF parsing -- iterative parsing and GFF2 nested features &#8211; Blue Collar Bioinformatics</title>

<meta name="keywords" content="how-to">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="More python GFF parsing -- iterative parsing and GFF2 nested features">

<meta name="twitter:site" content="@chapmanb">
<meta name="twitter:creator" content="@chapmanb">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="More python GFF parsing -- iterative parsing and GFF2 nested features">

<meta property="og:url" content="http://localhost:4000/2009/04/05/more-python-gff-parsing-iterative-parsing-and-gff2-nested-features/">
<meta property="og:site_name" content="Blue Collar Bioinformatics">





<link rel="canonical" href="http://localhost:4000/2009/04/05/more-python-gff-parsing-iterative-parsing-and-gff2-nested-features/">
<link href="http://feeds2.feedburner.com/bcbio" type="application/atom+xml" rel="alternate" title="Blue Collar Bioinformatics Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="http://localhost:4000/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/articles/" >Recent</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/tags/" >Topics</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">Blue Collar Bioinformatics</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Biological data analysis, validation and visualization</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#how-to" title="Pages tagged how-to">how-to</a></span>
        
          <h1 class="entry-title">More python GFF parsing -- iterative parsing and GFF2 nested features</h1>
        
      </header>
      <footer class="entry-meta">
        
          
        
          <img src="http://localhost:4000/images/diego-work.jpg" class="bio-photo" alt="Brad Chapman bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Brad Chapman</span></span>
        <span class="entry-date date published"><time datetime="2009-04-05T19:49:12-04:00"><i class="fa fa-calendar-o"></i> April 05, 2009</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
      </footer>
      <div class="entry-content">
        <p>
Work on the python generic feature format (GFF) parser continues to push forward; many thanks to those who have provided feedback in helping to refine the functionality. Previously, we discussed <a href="http://bcbio.wordpress.com/2009/03/08/initial-gff-parser-for-biopython/">the initial implementation</a>, introduced <a href="http://bcbio.wordpress.com/2009/03/22/mapreduce-implementation-of-gff-parsing-for-biopython/">MapReduce parsing for parallelization</a>, and discussed <a href="http://bcbio.wordpress.com/2009/03/29/python-gff-parser-update-parallel-parsing-and-gff2/">deploying on a cluster and GFF2 parsing</a>. This week describes an interface for iterator based parsing of GFF files and nested features for GFF2 files.</p>
<h3><b>Iterative parsing of GFF</b></h3>
<p>
GFF files are line-based and related features can be located anywhere in the file. To guarantee all features are parsed and combined correctly, the entire file needs to be scanned and loaded. For large files, we require strategies to load the data without abusing all available memory.</p>
<p>
In some cases, it is known that parsing the file in chunks will not result in any information being lost. <a href="http://solidsoftwaretools.com/gf/project/matogff/">GFF files produced by SOLiD for short read alignments</a> are one common case. These are read based, non-nested, and quite large. To tackle these files, the parser now has an iterator based interface that can be used to iterate over sections of the file:</p>
<p>[sourcecode language="python"]<br />
from BCBio.GFF.GFFParser import GFFAddingIterator</p>
<p>gff_iterator = GFFAddingIterator()<br />
for rec_dict in gff_iterator.get_features(gff_file, target_lines=3000000):<br />
    for rec in rec_dict.values():<br />
        # deal with rec.features<br />
[/sourcecode]</p>
<p>
This parses a file into ~350MB sized pieces, returning a dictionary of Biopython <code>SeqRecord</code> objects keyed by their names. Each <code>SeqRecord</code> contains all of the features added from that chunk of the file. These can be persisted to a database or otherwise analyzed before proceeding on to the next chunk, keeping memory requirements more reasonable.</p>
<p>
The file can still be filtered by feature type, allowing extraction of only features of interest. This example uses the Biopython <a href="http://www.biopython.org/wiki/SeqIO">SeqIO</a> interface to parse an initial FASTA file with our sequences, and then adds coding sequences on chromosome one to it in chunks of 1 million lines:</p>
<p>[sourcecode language="python"]<br />
from BCBio.GFF.GFFParser import GFFAddingIterator<br />
from Bio import SeqIO</p>
<p>with open(seq_file) as seq_handle:<br />
    seq_dict = SeqIO.to_dict(SeqIO.parse(seq_handle, "fasta"))<br />
gff_iterator = GFFAddingIterator(seq_dict)<br />
cds_limit_info = dict(<br />
        gff_types = [('Coding_transcript', 'gene'),<br />
                     ('Coding_transcript', 'mRNA'),<br />
                     ('Coding_transcript', 'CDS')],<br />
        gff_id = ['I']<br />
        )<br />
for rec_dict in gff_iterator.get_features(gff_file,<br />
        limit_info=cds_limit_info, target_lines=1000000):<br />
    for rec in rec_dict.values():<br />
        # deal with rec.features<br />
[/sourcecode]</p>
<p>
To avoid missing nested features, the iterator makes smart decisions about when to break the file. It is broken at points where all child features have their parents and can be expected to be nested correctly.</p>
<h3><b>Nested features for GFF2</b></h3>
<p>
Nesting of features is handled nicely in the new <a href="http://www.sequenceontology.org/gff3.shtml">GFF3 format</a>. However, many sources provide information in the older GFF2 (also called GTF) format, which has a variety of nesting schemes. The test examples for the parser contain some examples of these from different online repositories:</p>
<ul>
<li><a href="http://github.com/chapmanb/bcbb/blob/master/gff/Tests/GFF/ensembl_gtf.txt">Ensembl GFF2</a> -- recognizes child features by a <code>transcript_id</code> attribute, and does not provide a parent feature
  </li>
<li><a href="http://github.com/chapmanb/bcbb/blob/master/gff/Tests/GFF/wormbase_gff2.txt">WormBase GFF2</a> -- child features have a <code>Transcript</code> attribute for certain feature types; a parent feature is present, also with a <code>Transcript</code> attribute
  </li>
<li><a href="http://github.com/chapmanb/bcbb/blob/master/gff/Tests/GFF/jgi_gff2.txt">JGI GFF2</a> -- child features have a <code>TranscriptId</code> or <code>ProteinId</code> attribute and no parent feature
</li>
</ul>
<p>
The updated parser handles all these styles of nesting, building a top level feature for those files where this parent is not present. This mimics the new GFF3 behavior to ease the transition to those files. Where parent features are missing, a new feature is created of type <code>inferred_parent</code> which spans the distance of all child features. These child features are available from the <code>sub_features</code> attribute of the parent.</p>
<p>
These new updates improve parsing for older GFF2 files which are still widely used, and opens up parsing to new GFF files produced from SOLiD machines. The code is available from <a href="http://github.com/chapmanb/bcbb/tree/master/gff">the standard github location</a>. Please continue to pass along bug reports and suggestions.</p>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bcbio'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/2009/03/29/python-gff-parser-update-parallel-parsing-and-gff2/" class="btn" title="Python GFF parser update -- parallel parsing and GFF2">Previous</a>
      
      
        <a href="http://localhost:4000/2009/04/12/examining-and-adjusting-your-gff-file/" class="btn" title="Examining and adjusting your GFF file">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<div class="social-icons">
	<a href="https://twitter.com/chapmanb" title="Brad Chapman on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://github.com/chapmanb" title="Brad Chapman on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="https://github.com/chapmanb" title="Brad Chapman on Bitbucket" target="_blank"><i class="fa fa-bitbucket-square fa-2x"></i></a>
	
	
	
	
	
	
  
	
	<a href="https://linkedin.com/pub/3/300/8ba" title="Brad Chapman on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
  <a href="http://feeds2.feedburner.com/bcbio" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
